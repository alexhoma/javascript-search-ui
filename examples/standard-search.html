<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>AS UI - Suggested search</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <script src="../dist/apisearch-ui.js"></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="./standard.css" />
</head>

<body>
<!-- Navbar -->
<nav>
    <div id="search-wrapper">
        <!--<div>
            <input id="search2">
        </div>-->
        <div id="search2"></div>
        <div id="results">

        </div>
    </div>
</nav>

<script type="text/template" id="result-template">
    <div class="row">
        <div id="items" class="col-9">
            {{#items}}
            <div class="item">
                <img src="https://raw.githubusercontent.com/apisearch-io/funko-database/master/img/{{metadata.image}}"/>
                <div class="left-content">
                    <div>{{{fields.title}}}{{#fields.year}} <small>({{fields.year}})</small>{{/fields.year}}</div>
                    <div><small>From {{fields.collection.name}}</small></div>
                </div>

                <div class="right-content">
                    <div class="rating">{{{metadata.ratingCode}}}</div>
                </div>
                <div class="spacer" style="clear: both;"></div>
            </div>
            {{/items}}
        </div>
        <div id="links" class="col-3">
            <div id="suggestions">
                {{#suggestions}}
                <div><a href="?q={{.}}"><i class="fa fa-search"></i>&nbsp;{{.}}</a></div>
                {{/suggestions}}
            </div>
        </div>
    </div>

</script>

<script type="text/javascript">
    function itemsToStarRating(itemData) {
        let ratingNumber = parseInt(itemData.indexedMetadata.rating_5);
        let ratingCode = '';

        for(let index = 0; index < 5; index++) {
            if (index < ratingNumber) {
                ratingCode += '&nbsp;<i class="fa fa-star yellow"></i>';
            } else {
                ratingCode += '&nbsp;<i class="fa fa-star grey"></i>';
            }
        }

        itemData.metadata.ratingCode = ratingCode;

        return itemData;
    }
</script>

<script type="text/javascript">

    const urlParams = new URLSearchParams(window.location.search);
    const initialSearch = urlParams.get('q') ?? '';

    // UI Instance
    const ui = apisearchUI.create({
        app_id: 'as-29be77d7-2f64-4522',
        index_id: 'eu1-2de60e18-5fae-4155',
        token: 'eu1-8438694d-5839-4179-9f73-a55630f3cd4d',
        options: {
            endpoint: 'https://eu1.apisearch.io',
        }
    });

    // Widgets setup
    ui.addWidgets(
        ui.widgets.result({
            target: '#results',
            itemsPerPage: 8,
            highlightsEnabled: true,
            suggestionsEnabled: true,
            formatData: itemsToStarRating,
            template: {
                itemsList: document.getElementById('result-template').text
            }
        }),
        ui.widgets.searchInput({
            target: '#search2',
            placeholder: 'Type to search...',
            autocomplete: true,
            initialSearch: initialSearch,
        })
    );

    // Init the magic!
    ui.init({firstQuery: initialSearch !== ''});
</script>
</body>
</html>
